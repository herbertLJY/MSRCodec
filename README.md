<div align="center">
    <h1>
    MSR-Codec
    </h1>
    <p>
    Official PyTorch code for inference of <br>
    <b><em>MSR-Codec: A Low-Bitrate Multi-Stream Residual Codec for High-Fidelity Speech Generation with Information Disentanglement</em></b>
    </p>
    <p>
      MSR-Codec: A Low-Bitrate Multi-Stream Residual Codec for High-Fidelity Speech Generation with Information Disentanglement<br>
      Jingyu Li^1, Guangyan Zhang^1, Zhen Ye^2, Yiwen Guo^3<br>
      1^LIGHTSPEED, Hong Kong SAR<br>
      2^The Hong Kong University of Science and Technology, Hong Kong SAR<br>
      3^Independent Researcher, Corresponding Author<br>
    </p>
</div>

<!-- ## MRS-Codec ðŸ”¥ -->

### Overview

Audio codecs are a critical component of modern speech generation systems. This paper introduces a low-bitrate, multi-scale residual codec that encodes speech into four distinct streams: semantic, timbre, prosody, and residual. This architecture achieves high-fidelity speech reconstruction at competitive low bitrates while demonstrating an inherent ability for information disentanglement. We construct a two-stage language model for text-to-speech (TTS) synthesis using this codec, which, despite its lightweight design and minimal data requirements, achieves a state-of-the-art Word Error Rate (WER) and superior speaker similarity compared to several larger models. Furthermore, the codecâ€™s design proves highly effective for voice conversion, enabling independent manipulation of speaker timbre and prosody.

### Key Words

- **Audio Codec**
- **Speech Generation**
- **Low-bitrate**
- **Information Disentanglement**

### Key Words
Our paper on this project has been published! You can read it here: [MRS-Codec](https://arxiv.org/pdf/2509.13068). 


## Installation
**Clone and Install**

  Here are instructions for installing on Linux. 


- Clone the repo
``` sh
git clone https://github.com/SparkAudio/Spark-TTS.git
cd Spark-TTS
```

- Install Conda: please see https://docs.conda.io/en/latest/miniconda.html
- Create Conda env:

``` sh
conda create -n msrcodec -y python=3.10
conda activate msrcodec
```
- Please install the textless first, following https://github.com/facebookresearch/textlesslib/tree/main

- Or 
``` sh
git clone https://github.com/facebookresearch/textlesslib.git
git clone https://github.com/facebookresearch/fairseq.git
export PYTHONPATH=textlesslib/:fairseq/:$PYTHONPATH
```
- Install requried libraries:
``` sh
pip install -r requirements.txt
```

## **Basic Usage**

You can simply run the demo with the following commands:
``` sh
bash infer.sh
```

Alternatively, you can modify the script to generate your speechesï¼š

``` sh
python ignore inference.py \
    --prompt_wav assets/src/121_127105_000009_000000.wav \
    --prompt_text "We say, of course, somebody exclaimed, that they give two turns!" \
    --gen_text "How are you? This is lightspeed studio from tencent." \
    --output_dir out_dir
```

## **Demos**

Here are some demos generated by Spark-TTS using zero-shot voice cloning. For more demos, visit our [demo page](https://herbertljy.github.io/MSRCodec/).

<!-- ---
Zero-shot TTS
---

<table>
      <thead>
        <tr>
          <th>Prompt Text</th>
          <th>Prompt Speech</th>
          <th>Generated Text</th>
          <th>Generated Speech</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>On the second day, the boy climbed to the top of a cliff near the camp.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_17161.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>The area was swirling in dust so intense that it hid the moon from view.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_17161-common_voice_en_17160.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
        </tr>
        <tr>
          <td>She wasn't home, a neighbour said that he didn't think she came in last night.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_17389984.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>Technically, breaking a mirror is not five years, but seven years of bad luck.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_17389984-common_voice_en_17389988.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
        </tr>
        <tr>
          <td>Several people are walking out in the spotlight.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_177895.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>A man is taking a look at the food products.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_177895-common_voice_en_177898.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
        </tr>
        <tr>
          <td>The music, while technically a waltz, sounded more like a drunken tuba player falling into the orchestra's percussion section.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_18012457.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>One of the world's biggest problems is the growth of the human population.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_18012457-common_voice_en_18012447.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
        </tr>
        <tr>
          <td>She was singularly quick, singularly receptive.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_18554437.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>Can't you see the scene? he asked with a queer smile of excitement.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_18554437-common_voice_en_18554439.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
        </tr>
        <tr>
          <td>Some development processes usually conducted sequentially were conducted in parallel.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_18672480.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>In testimony to investigators, the page described the relationship as consensual and not intimidating.</td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/tts/common_voice_en_18672480-common_voice_en_18672484.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
        </tr>
      </tbody>
    </table>

---
Voice Conversion
---

<table>
      <thead>
        <tr>
          <th>Timbre Prompt</th>
          <th>Source Audio</th>
          <th>Cosyvoice2</th>
          <th>Seed-VC</th>
          <th>524+S</th>
          <th>524+P</th>
          <th>524+S+P</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td rowspan="3">
            <audio controls preload="metadata">
              <source src="./assets/target/p318_354.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/8555_284449_000053_000001.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
            <span class="timbre-meta">
              It isn't a very pretty cabin and the furniture is cheap and common, but I'm sure it is good enough for this wicked man and his family.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p318_354_8555_284449_000053_000001.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p318_354_8555_284449_000053_000001.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p318_354_8555_284449_000053_000001.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p318_354_8555_284449_000053_000001.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p318_354_8555_284449_000053_000001.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/1188_133604_000004_000005.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              You see how doubly, how intimately, opposed the ideas are; yet how difficult to explain without apparent contradiction.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p318_354_1188_133604_000004_000005.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p318_354_1188_133604_000004_000005.wav" type="audio/mpeg">
            </audio>
          </td>
                    <td><audio controls preload="metadata">
              <source src="./assets/524/p318_354_1188_133604_000004_000005.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p318_354_1188_133604_000004_000005.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p318_354_1188_133604_000004_000005.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/260_123440_000015_000000.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              As she said this she looked down at her hands, and was surprised to see that she had put on one of the Rabbit's little white kid gloves while she was talking.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p318_354_260_123440_000015_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p318_354_260_123440_000015_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p318_354_260_123440_000015_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p318_354_260_123440_000015_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p318_354_260_123440_000015_000000.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td rowspan="3">
            <audio controls preload="metadata">
              <source src="./assets/target/p269_236.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/121_127105_000044_000000.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              He had been left, by the death of their parents in India, guardian to a small nephew and a small niece, children of a younger, a military brother, whom he had lost two years before.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p269_236_121_127105_000044_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p269_236_121_127105_000044_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p269_236_121_127105_000044_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p269_236_121_127105_000044_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p269_236_121_127105_000044_000000.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/8230_279154_000020_000000.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              The second datum is that we certainly have more capacity for knowing the past than for knowing the future.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p269_236_8230_279154_000020_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p269_236_8230_279154_000020_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p269_236_8230_279154_000020_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p269_236_8230_279154_000020_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p269_236_8230_279154_000020_000000.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/8455_210777_000065_000000.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              Captain Battleax, of the john Bright, will have received a letter to the same effect from the First Lord of the Admiralty, and you will find him ready to co-operate with your Excellency in every respect.--I have the honour to be, sir, your Excellency's most obedient servant,
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p269_236_8455_210777_000065_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p269_236_8455_210777_000065_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p269_236_8455_210777_000065_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p269_236_8455_210777_000065_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p269_236_8455_210777_000065_000000.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td rowspan="3">
            <audio controls preload="metadata">
              <source src="./assets/target/p364_009.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/1089_134691_000024_000000.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              He recognized their speech collectively before he distinguished their faces.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p364_009_1089_134691_000024_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p364_009_1089_134691_000024_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p364_009_1089_134691_000024_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p364_009_1089_134691_000024_000000.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p364_009_1089_134691_000024_000000.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/1580_141084_000016_000002.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              It is possible that I may be in a position then to indicate some course of action.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p364_009_1580_141084_000016_000002.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p364_009_1580_141084_000016_000002.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p364_009_1580_141084_000016_000002.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p364_009_1580_141084_000016_000002.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p364_009_1580_141084_000016_000002.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/237_134500_000023_000002.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              She wouldn't know how to go about it.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p364_009_237_134500_000023_000002.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p364_009_237_134500_000023_000002.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p364_009_237_134500_000023_000002.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p364_009_237_134500_000023_000002.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p364_009_237_134500_000023_000002.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td rowspan="3">
            <audio controls preload="metadata">
              <source src="./assets/target/p237_196.wav" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/2300_131720_000040_000001.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              The station at Berlin comprised five boilers, and six vertical steam engines driving by belts twelve Edison dynamos, each of about fifty five horse power capacity.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p237_196_2300_131720_000040_000001.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p237_196_2300_131720_000040_000001.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p237_196_2300_131720_000040_000001.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p237_196_2300_131720_000040_000001.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p237_196_2300_131720_000040_000001.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/4446_2275_000002_000007.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              She called his name on the threshold, but in her swift flight across the room she felt a change in him and caught herself up so deftly that he could not tell just when she did it. She merely brushed his cheek with her lips and put a hand lightly and joyously on either shoulder.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p237_196_4446_2275_000002_000007.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p237_196_4446_2275_000002_000007.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p237_196_4446_2275_000002_000007.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p237_196_4446_2275_000002_000007.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p237_196_4446_2275_000002_000007.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
        <tr>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/src/3570_5694_000006_000006.wav" type="audio/mpeg">
            </audio>
            <span class="timbre-meta">
              When the quasi peaceable stage of industry is reached, with its fundamental institution of chattel slavery, the general principle, more or less rigorously applied, is that the base, industrious class should consume only what may be necessary to their subsistence.
            </span>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/cosyvoice2/p237_196_3570_5694_000006_000006.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/seed_vc/p237_196_3570_5694_000006_000006.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524/p237_196_3570_5694_000006_000006.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_prosody/p237_196_3570_5694_000006_000006.wav" type="audio/mpeg">
            </audio>
          </td>
          <td>
            <audio controls preload="metadata">
              <source src="./assets/524_spk_prosody/p237_196_3570_5694_000006_000006.wav" type="audio/mpeg">
            </audio>
          </td>
        </tr>
      </tbody>
    </table>
     -->
